<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eletIFAS - EEMTI DRAG√ÉO DO MAR</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #004d40; --secondary: #00796b; --bg: #f1f8f7; --accent: #c62828; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); margin: 0; padding: 10px; display: flex; justify-content: center; }
        .container { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 550px; text-align: center; position: relative; min-height: 600px; display: flex; flex-direction: column; align-items: center; }
        .hidden { display: none !important; }
        .logo-escola { width: 120px; margin: 0 auto 10px auto; display: block; }
        h1 { color: var(--primary); font-size: 28px; margin: 0; }
        h2 { color: var(--secondary); font-size: 16px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
        input, select, button { width: 100%; padding: 12px; margin-top: 8px; border-radius: 8px; border: 1.5px solid #ccc; box-sizing: border-box; font-size: 16px; }
        .btn-main { background: var(--primary); color: white; font-weight: bold; cursor: pointer; border: none; }
        .btn-outline { background: white; color: var(--primary); border: 2px solid var(--primary); font-weight: bold; cursor: pointer; }
        .btn-link { background: none; border: none; color: var(--secondary); text-decoration: underline; cursor: pointer; font-size: 13px; margin-top: 10px; }
        .btn-sair { background: var(--accent); color: white; padding: 8px 15px; font-size: 12px; border: none; border-radius: 6px; cursor: pointer; width: auto; position: absolute; top: 20px; right: 20px; }
        .footer-credits { margin-top: auto; padding-top: 30px; font-size: 11px; color: var(--accent); font-family: 'Courier New', Courier, monospace; font-weight: bold; line-height: 1.4; }
        .tabela-wrapper { overflow-x: auto; margin-top: 15px; width: 100%; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { background: var(--primary); color: white; padding: 8px; }
        td { border: 1px solid #ddd; padding: 5px; text-align: center; }
        .nome-aluno { text-align: left; font-size: 10px; font-weight: bold; text-transform: uppercase; min-width: 150px; }
        .input-nota { width: 45px; text-align: center; padding: 5px; border-radius: 4px; border: 1px solid #ccc; display: none; }
        .show-nota { display: inline-block !important; }
        .toggle-col { background: #e0f2f1; border: 1px solid var(--primary); font-size: 10px; padding: 2px 5px; cursor: pointer; border-radius: 4px; display: block; margin-top: 3px; color: #333; }
        .col-ativa { background: var(--secondary) !important; color: white !important; }
        .aluno-card { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; width: 100%; }
        .aluno-nome { font-size: 11px; text-align: left; flex: 1; text-transform: uppercase; }
        .toggles-chamada { display: flex; gap: 5px; }
        .t-btn { width: 32px; height: 32px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 12px; border-radius: 4px; background: #fff; }
        .active-p { background: #2e7d32 !important; color: white !important; }
        .active-f-cor { background: var(--accent) !important; color: white !important; }
        .active-j { background: #ef6c00 !important; color: white !important; }
    </style>
</head>
<body>

<div class="container">
    <img src="imagem1.png" class="logo-escola" alt="Logo EEMTI">
    <h1>eletIFAS</h1>
    <h2>EEMTI DRAG√ÉO DO MAR</h2>

    <div id="tela-login" style="width: 100%;">
        <input type="email" id="login-email" placeholder="E-mail">
        <input type="password" id="login-senha" placeholder="Senha">
        <button class="btn-main" onclick="acaoLogin()">ENTRAR</button>
        <button class="btn-link" onclick="esqueciSenha()">Esqueci minha senha</button>
        <button class="btn-outline" style="margin-top:20px" onclick="mostrarTela('tela-cadastro')">CRIAR CONTA</button>
    </div>

    <div id="tela-cadastro" class="hidden" style="width: 100%;">
        <h3>Novo Professor</h3>
        <input type="text" id="cad-nome" placeholder="Nome Completo">
        <input type="email" id="cad-email" placeholder="E-mail">
        <input type="password" id="cad-senha" placeholder="Senha">
        <button class="btn-main" onclick="acaoCadastro()">CADASTRAR</button>
        <button class="btn-outline" style="margin-top:10px" onclick="mostrarTela('tela-login')">VOLTAR</button>
    </div>

    <div id="tela-index" class="hidden" style="width: 100%;">
        <button class="btn-sair" onclick="fazerLogout()">SAIR</button>
        <div style="text-align:left; font-size:12px; color: #666; margin-bottom: 10px;" id="info-prof">Professor</div>
        <input type="date" id="data-aula">
        <select id="area">
            <option value="">Selecione a √Årea...</option>
            <option value="GEST√ÉO">GEST√ÉO</option>
            <option value="Linguagens">Linguagens</option>
            <option value="Matem√°tica">Matem√°tica</option>
            <option value="C. Natureza">Ci√™ncias da Natureza</option>
            <option value="C. Humanas">Ci√™ncias Humanas</option>
        </select>
        <select id="modalidade" onchange="atualizarTurmas()">
            <option value="">Modalidade...</option>
            <option value="integral">Integral</option>
            <option value="noturno">Noturno</option>
        </select>
        <select id="turma"><option value="">Selecione a Turma...</option></select>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn-main" onclick="abrirModulo('chamada')">üìù CHAMADA</button>
            <button class="btn-outline" onclick="abrirModulo('notas')">üìä NOTAS</button>
        </div>
    </div>

    <div id="tela-chamada" class="hidden" style="width: 100%;">
        <h3 id="titulo-chamada"></h3>
        <div id="lista-alunos-chamada" style="max-height: 400px; overflow-y: auto;"></div>
        <button class="btn-main" style="margin-top:20px" id="btn-salvar-freq" onclick="enviarFrequencia()">SALVAR CHAMADA</button>
        <button class="btn-outline" style="margin-top:10px" onclick="mostrarTela('tela-index')">VOLTAR</button>
    </div>

    <div id="tela-notas" class="hidden" style="width: 100%;">
        <h3 id="titulo-notas"> Lan√ßamento de Notas</h3>
        <select id="bimestre-selecionado">
            <option>1¬∫ BIMESTRE</option><option>2¬∫ BIMESTRE</option>
            <option>3¬∫ BIMESTRE</option><option>4¬∫ BIMESTRE</option>
        </select>
        <div class="tabela-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Estudante</th>
                        <th>N1 <span class="toggle-col" id="t-n1" onclick="toggleNota('n1')">LIGAR</span></th>
                        <th>N2 <span class="toggle-col" id="t-n2" onclick="toggleNota('n2')">LIGAR</span></th>
                        <th>N3 <span class="toggle-col" id="t-n3" onclick="toggleNota('n3')">LIGAR</span></th>
                        <th>M√âD.</th>
                    </tr>
                </thead>
                <tbody id="corpo-notas"></tbody>
            </table>
        </div>
        <button class="btn-main" style="margin-top:20px" id="btn-salvar-notas" onclick="enviarNotas()">SALVAR NA PLANILHA</button>
        <button class="btn-outline" style="margin-top:10px" onclick="mostrarTela('tela-index')">VOLTAR</button>
    </div>

    <div class="footer-credits">
        DESENVOLVIDO POR D.S.MONTENEGRO - 2026<br>
        LEI - EEMTI DRAG√ÉO DO MAR
    </div>
</div>

<script>
    const SUPABASE_URL = 'https://bdjqajzhlkdfagdfknmh.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_OzKhMbCCGNxDLcpmLb4SIg_2I-bKYf1';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    const GOOGLE_URL = 'https://script.google.com/macros/s/AKfycbwnwtgo2e2X3UCgRcBtVAy6xdHZdbXVC-X8t2owARg1YoMyGUuzOFtSzKGhUVIecpqwBQ/exec';

    let professorAtivo = "";
    let listaAtualAlunos = [];
    document.getElementById('data-aula').valueAsDate = new Date();

    const dadosEscola = {
        integral: {
            "1¬∫ A": ["ANA BEATRIZ CABRAL DA SILVA", "ANA BEATRIZ DANTAS BERNARDO", "ANA BEATRIZ OLIVEIRA SERRA", "ANA CAROLYNA CARNEIRO SOUSA", "ANA LUIZA DE SOUSA LOURENCO", "ANNA JULIA RODRIGUES DE MELO", "DEBORA IOLANDA GOMES DA SILVA", "DEVIDSON RAMOS DE OLIVEIRA", "DIOGO SANTOS FERREIRA", "FERNANDO ERLANIO DE OLIVEIRA AGUIAR", "JESSICA DEBORA SILVA OLIVEIRA", "JOAO GABRIEL SOUSA RODRIGUES", "JOAO LUCAS SOUSA DA COSTA", "JORGE MIGUEL ARAUJO LOPES", "JULIA EVELLEN PAIVA DA SILVA", "KAILANY DA SILVA COSTA", "KAROLLAINY OLIVEIRA SOUSA", "KAUA ARAUJO MENDES", "LUIS GUSTAVO COSTA FERNANDES", "LUNNA DE LIMA ABREU", "MARA LIDIA FERREIRA DE FARIAS", "MARIA ALICIA CARVALHO NUNES", "MARIA CLARA DA CRUZ SILVA", "MARIA EDUARDA BERNARDO SOUZA", "MARIA ISABEL ALVES PEREIRA", "MARYA EDUARDA DOS SANTOS LOBAO", "MOISES ARCANJO FLOR FERREIRA", "RAYSSA DA SILVA RODRIGUES", "RYAN DA SILVA COSTA", "SAMUEL SANTIAGO DE LIMA", "SAMYRA MARIA CAVALCANTE CRUZ", "THALES GABRIEL FERREIRA DE LIMA", "TIAGO TAVARES SOUZA", "YANN FERREIRA SILVA COELHO", "YASMIN SILVA COUTO"],
            "1¬∫ B": ["ALESSANDRO DOS SANTOS RODRIGUES", "ANA ESTER DA SILVA FELIX", "ANA RUTY PEREIRA DOS SANTOS", "ARIELE DE CARVALHO GONDIM BARBOSA LEMOS", "BERNARDO BATISTA LIMA", "BRENO HENRIQUE CASTRO VALENTIM", "EDUARDO SOUSA GAMA", "ESTER VIRGINIO MARIANO", "FILIPE BRAS DE PAULA", "FRANCISCO EDILSON OLIVEIRA ANDRADE", "GABRIELA RODRIGUES DOS SANTOS", "GEORGE TEODOZIO SILVA", "GUSTAVO NERY TEIXEIRA DE PAULA", "IAN DE ABREU VIANA", "JOSE MARLEY MENDES DOS SANTOS", "LARA WINY SOUSA DA SILVA", "LOUISE ANDRYA FERREIRA DE SOUSA LIMA", "LUARA KALYNE DA CONCEICAO SARAIVA", "LUDMILA LOPES EVANGELISTA", "MARCOS VINICIUS ARAUJO LIMA ALVES", "MARIA BEATRIZ TELES GUEDES DE SOUSA", "MARIA EDUARDA MARTINS DANTAS", "MARIA GABRIELA DA SILVA MACEDO ARAUJO", "MARIA MANUELA FERREIRA LIMA", "MARIA VITORIA SANTOS DE LIMA", "MAYRA ALEXANDRA DOS SANTOS CARMO", "MIGUEL ANTONIO LOPES DA CUNHA", "NATHALLY ELOAR DO SANTOS HENRIQUE DA SILVA", "PAULO LUCAS VIEIRA DOS SANTOS", "PEDRO LUAN OLIVEIRA SANTOS", "PEDRO LUCAS ARAUJO BRAUNA", "RHUAN DE BRITO RODRIGUES", "RODRIGO OLIVEIRA DA SILVA", "SAULO LUKA PESSOA TABOSA", "YAN DAVID FEITOSA RODRIGUES"],
            "1¬∫ C": ["ALICE FIRMINO DOS SANTOS SILVEIRA", "ANA LIVIA DA CRUZ BORGES", "ANA VITORIA SOUSA DE LIMA", "BRENDO LUCAS DOS SANTOS SOUSA", "BRIAN VALENTE DOS SANTOS", "CAIO VICTOR SALES DO NASCIMENTO", "CARLOS YUDI SILVA DO NASCIMENTO", "CECILIA BORGES OLIVEIRA", "DALILA SIMONE DOS SANTOS", "ELNATAN DOS REIS RODRIGUES", "ERICK SANTOS ARAUJO", "FABIANO SANTIAGO DOS ANJOS", "FRANCISCO MANOEL DOS ANJOS DA SILVA", "GABRIEL CASTRO DE SOUSA", "HELLEN MARIA DO NASCIMENTO BERNARDO", "ISABELE ROCHA FERREIRA", "JOAO LEVI GOMES VIEIRA", "JOAO PEDRO LIMA SOARES", "JOAO VITOR DE PAULO DO NASCIMENTO", "JOSE CAUA DOS SANTOS RODRIGUES", "JULIA NICOLY DE LIMA", "KEVEN GABRIEL DE SOUSA RIBEIRO", "LUIZ OTAVIO DA SILVA MOREIRA", "MARIA EDUARDA BEZERRA SANTOS", "MARIA EDUARDA RODRIGUES GUIMARAES", "MARIA LUIZA DA SILVA FRANCA", "MARIA VITORIA DA SILVA DO NASCIMENTO", "SAMUEL FREITAS ALVES", "SARAH KELLY FERREIRA SOUSA", "YAN MIQUEIAS OLIVEIRA ALVES", "YASMIN PESSOA DA ROCHA", "RONNALD LOPES DE OLIVEIRA", "EMANUEL ARA√öJO MANSUR", "SAMUEL DO VALE DE OLIVEIRA", "VIT√ìRIA NYCOLE LOPES DE OLIVEIRA", "PEDRO GABRIEL TABOSA ROSENO", "ANA KETHELLY AGUIAR DE SOUZA"],
            "2¬∫ A": ["ANA LIVIA DOS SANTOS BARATA", "ANTONIO VINICIUS ROCHA FERREIRA", "BRYANN VICTOR PEREIRA XAVIER", "CARLA SAMANTHA DE OLIVEIRA ASSARE", "CLARISSE YASMIN DA SILVA EVARISTO", "EMANUELLE HIGINO DE SOUZA", "ENZO DOS SANTOS MONTEIRO", "ERIK DOUGLAS LIMA MARTINS", "FRANCISCO WEVERTON DOS SANTOS", "GUILHERMY KAUA DA SILVA FERREIRA", "IRVINA AGATA DA SILVA FRANCA", "JENYFER RAISSA DO NASCIMENTO COSTA", "JESSIANE RIBEIRO CARNEIRO", "KAUA GUILHERME CRUZ SILVA", "KELRIANE BARROS DA COSTA", "LUIZ EDUARDO LOURENCO FIGUEIRA MACEDO", "MARCOS KAYRON ALBUQUERQUE ALVES", "MARIA IONARA FERREIRA DOS SANTOS", "MARIA SARAH LOPES DE BRITO", "MAYCON DO NASCIMENTO PEREIRA", "NARA LAUANE CARNEIRO FERREIRA", "PEDRO GABRIEL MOREIRA DA COSTA", "PEDRO HENRIQUE SOUSA MARTINS DA SILVA", "PEDRO VIN√çCIUS OLIVEIRA DOS ANGELOS", "RYAN BARBOSA DE SOUSA", "SUELEN CRISTINA FARIAS LEAL", "VITORIA SANTOS DE OLIVEIRA SILVA", "WELLY DE CASTRO BULHOES", "YURI CAETANO CARVALHO"],
            "2¬∫ B": ["ANA BRUNA FELIX ACARCIO PEREIRA", "ANA LAYS DE ALMEIDA", "ANA LIVIA VASCONCELOS LOBO ROCHA", "ANA VITORIA DE SOUZA AMARAL", "CALEBE DA SILVA SANTOS", "CECILIA SILVA OLIVEIRA", "DEBORAH CARVALHO BEZERRA", "GLENDA VITORIA GOMES DE LIVIA", "GUILHERME BARBOSA LOURENCO", "JOAO PIERRY ALVES DE OLIVEIRA", "JOEL BARBOSA EVANGELISTA", "KAROLYNNE", "KERISSON ANDRADE AMORIM", "KEYLLON VITORIO DE SOUZA AMBE", "LUANA FONSECA MONTEIRO", "LUCAS OLIVEIRA DE SOUZA", "MARCOS VINICIUS SILVANO BATISTA", "MARIA EDUARDA SANTANA RODRIGUES", "MARIA HELLEN SOUSA BARROS", "MIGUEL RONEY PEREIRA DUARTE", "MOYSHES GOMES DO NASCIMENTO", "NICOLAS DE FREITAS LOPES", "NYKOLAS PEREIRA RIOS", "PEDRO RIBEIRO HOLANDA", "RIHANHA FERREIRA DOS REIS", "RYANBERG FERREIRA BARBOSA DA SILVA", "VARVARA OZEROVA", "VICTOR GABRIEL LIMA DE SOUZA", "YAN DHARLLYS MARTINS DO NASCIMENTO"],
            "2¬∫ C": ["AMANDA PEREIRA DA PENHA", "ANA JULIA FERNANDES DE SOUSA", "ANA LARA CORREIA LOPES", "ARTHUR CARLOS DE ALMEIDA MOTTA", "ARTHUR MONTENEGRO VENANCIO", "BRENDA PEREIRA LIMA", "ELLEN CRISTINA SILVA DOS SANTOS", "EZEQUIEL GOMES DE SENA", "FRANCISCA SAMILLY DA SILVA ARAUJO", "GABRIEL ARAUJO SILVA", "GABRIEL ONOFRE DE SOUSA MACIEL", "HELOARA MORAES VERCOSA", "JOSE ELIVELTON OLIVEIRA MAGALHAES", "KAUA EMERSON LIMA MENEZES", "KAYANNE RODRIGUES TEIXEIRA", "KENCIANE OLIVEIRA DE SOUSA", "MARIA ALICE RIBEIRO DA SILVA", "MARIA APARECIDA SILVA DE SOUZA", "MARIA EDUARDA CARIOLANO DE ARAUJO", "MARIA FERNANDA SILVA DOS SANTOS FELIX", "MARIA LAYANE MONTEIRO DE LIMA", "MIGUEL VASCONCELOS DINIZ", "MIRELLA DE PAULA NASCIMENTO", "PEDRO ADRIAN DA SILVA", "PEDRO ITALO MAIA SOUSA", "PEDRO LUCAS FEIJ√ì", "REBECA DIOGO SILVA MONTENEGRO", "SAMYLLY RAYSSA DIAS ARAUJO", "SUZANNA RAFAELLE COSTA S. DO NASCIMENTO", "YURI ANDRADE DA MATA"],
            "3¬∫ A": ["ADRYAN DE PAULA ANDRADE", "ALISSON COSTA DA SILVA", "ANA BEATRIZ FURTADO TAVARES", "ANA CAROLINE AIRES PEREIRA", "ARIANI DA GUIA DOS SANTOS", "BRUNO KENNEDY SOUSA SOARES", "CAMILY DE OLIVEIRA COSTA", "DANIELA CASTRO DE SOUZA", "DIOGO ADRIAN TAVARES DE LIMA", "EMANUELLE FERREIRA DE SOUSA", "EMANUELLY DE CASSIA PINTO QUEIROZ", "EMILY SOARES CUNHA GOMES", "FERNANDO ANTONIO MOTA DE SOUSA FILHO", "ISABELLA ALVES PEREIRA", "IZABELLE CARVALHO SILVA", "JEFERSON LAZANO MENDES DINIZ", "JOAO NICOLAS DO NASCIMENTO", "JO√ÉO PEDRO", "KAYLA VITORIA MARQUES CAMPOS", "KELTON MATEUS DE SOUSA NEVES", "LARA RAYELE BORGES GOES", "LAYS NAYRA GOMES FERREIRA", "LETICIA BARBOSA TEIXEIRA", "LIAN DE SOUSA FERREIRA", "LUIDY RAYAN PEREIRA DA SILVA", "LUIS DANIEL ALMEIDA DA SILVA", "LUIZ GUSTAVO SANTANA DA MATA", "MARIA FERNANDA SILVA SOUSA", "PEDRO ERICK BEZERRA DE LIMA", "PEDRO LUCAS DA SILVA GOMES", "PEDRO LUCAS LOPES MATIAS", "SILAS DOS SANTOS ALMEIDA", "YARLEI FERREIRA LOBAO", "YASMIM LOURENCO DE FREITAS"],
            "3¬∫ B": ["ANA ALICE RODRIGUES DA SILVA", "ANA CLARA DOS SANTOS DE PAULA", "ANA KARINE ALBERTO SILVA", "ANA LUIZA ALVES DE OLIVEIRA", "ANDRE HENRIQUE DE SOUZA CAMPOS", "ANGELA PATRICIA OLIVEIRA FRANCA LIMA", "ANTONIA VANESSA LIMA DA MATA", "CARLOS MISAEL DA SILVA FELIX", "EDUARDA GABRIELE FERREIRA DOS SANTOS", "FL√ÅVIO NOGUEIRA FILHO", "FRANCISCO HUGO DA SILVA ARAUJO", "FRANCISCO RENAN DE SOUZA RODRIGUES", "GABRIEL VITOR ABREU MORAES", "GUDSON MACEDO SANTANA", "ISAAC ASSUNCAO RODRIGUES DE MATOS", "JOAO MANOEL DIONIZIO DA SILVA", "JOAO VICTOR SOUSA DA COSTA", "JOSE ADRIEL DE SOUSA BERNARDO", "JOSE RENAN ARAUJO LIMA CASTRO", "KATHERINE LEITE BRAGA", "KERLLON PAZ DA SILVA", "LARA GABRIELLE RODRIGUES MORAIS", "LETICIA HONORATO ALVES", "LUCAS DOS SANTOS MATOKANOVIC", "MARCIO MARLEY RIBEIRO DA SILVA", "MARCUS YUAN PACHECO DE SOUSA", "MARIA CLARA CALDAS RODRIGUES", "MARIA EVELYN DA SILVA SABINO", "ROMAN DUBOVIK", "RYAN PEREIRA DE SOUSA", "RYANNA FERREIRA RODRIGUES", "SAMUEL MOREIRA FERREIRA", "VERONICA DANIELA NUNEZ TORRES", "WESLEI FERREIRA GOIS", "YORRANA DA SILVA GON√áALVES"]
        },
        noturno: {
            "1¬∫ D": ["ANA PAULA FERREIRA DA SILVA", "ANA LARA LOPES POLICARPO", "CARLOS EDUARDO S. NASCIMENTO", "CARLOS ICARO SOUSA BARRETO", "CARMEN L√öCIA DO NASCIMENTO SANTOS", "CYNTHIA BIANCA RIBEIRO", "DHEIMISON LEANDRO", "DIOGO VINICIUS RIBEIRO DE SOUSA", "EDUARDO DA SILVA SILVEIRA", "FRANCISCA SILVANEIDE DA SILVA", "JOSE CAUA DOS SANTOS RODRIGUES", "LAURA CLARIANE LIMA DUARTE", "LUAN RODRIGUES DE MORAIS", "MARIA FREITAS DE ALMEIDA", "MARIA GABRIELA VERAS FERREIRA", "MARIA VANUSIA COELHO", "NATANAEL LOBAO DA SILVA", "NATIELE GOMES COSTA", "RAYSSA SOUSA COSTA", "ROSA MARIA DA SILVA", "SAMUEL COSTA REBOUCAS", "SIMONE ALVES DE SOUSA", "THAYSSA STHER FELIX REBOU√áAS", "WILCKY SANTOS PEREIRA", "YOHANA CORTEZ DE AZEVEDO", "YURI TEIXEIRA DA SILVA", "Joyse kely", "Marina Rodrigues"],
            "2¬∫ D": ["ARIEL LUCAS CARVALHO", "ARIELY LET√çCIA LIMA OLIVEIRA", "CARLOS RYAN OLIVEIRA FERREIRA", "DOUGLAS MARCELO FERNANDES OLIVEIRA DE MELO", "ELOIZA ZAQUEU DA SILVA SANTOS", "EMILY AZEVEDO DOS SANTOS", "FAGNER LUCENA DA SILVA", "FRANCISCO DAVI RIBEIRO FREITAS", "FRANCISCO ELIVERTON ALVES DIAS", "GABRIEL HENRIQUE FREITAS DE CARVALHO", "JOAO MARCOS NOGUEIRA PEREIRA", "JOSE ROMULO FACUNDE DA SILVA", "JULYAM NAYRIS GUEDES ALBUQUERQUE", "KATIANE DE SOUZA JULIAO GOMES", "KAUA CUNHA MATIAS", "LEANDRO RAQUEL GOMES", "LUANA PRISCILA OLIVEIRA", "LUCAS HONORIO DE SOUSA", "MARIA SUYANE BARBOSA GOMES", "MELISSA DOS SANTOS VITURINO", "PEDRO YTALLO ALVES DE ARAUJO MOTA", "RAY PEREIRA ROCHA NOGUEIRA", "RAYANE BERNARDO DA SILVA SOARES", "RIAN DE LIMA NASCIMENTO", "SARA ROCHA DE SENA", "STEPHANY REIS FONSECA", "TAINARA DE SOUZA", "NICOLE KETLIN DE OLIVEIRA", "ANA LUIZA LOMBARDI MESQUITA", "GABRIEL FREITAS DOS SANTOS", "LUZIA KETTILY", "FRANCISCO WEVERTON DOS SANTOS"],
            "3¬∫ C": ["ANA LUISA PEREIRA DOS SANTOS", "ARYANE SILVA DA GUIA", "EDUARDO DA SILVA MACEDO ARAUJO", "ERIANA KEZIA NASCIMENTO RODRIGUES", "FRANCISCA ELLEN CASTRO DOS SANTOS", "GABRIELEM MARIA LIMA DE CASTRO", "IZABELE MARTINS DE SOUSA", "JOAO MARCELO CESARIO DA SILVA", "JONATHAN VITOR DA SILVA ALVES", "KAUA CARDOSO DE OLIVEIRA", "KAUA KEVEN AZEVEDO DA SILVA", "LUIZ DAVI CRUZ DA ROCHA", "MARIA JAMILE DE SOUSA PEREIRA", "MARIA REBECA SILVA DA CRUZ", "MARIANA NASCIMENTO DA SILVA", "NICOLAS ARAUJE DE FREITAS", "SAMUEL RODRIGUES GOMES", "SARA DOS SANTOS HAYASHI", "VITORIA CAROLINE MORAIS DE LIMA", "WESLEY SANTANA FIRMINO", "ISRAEL LUIS DE PAULA ROCHA", "DANILO DOS SANTOS PEREIRA", "LUCAS DIOGO", "GABRIEL VALENTIM", "Adalberto", "Paulo Renan"]
        }
    };

    function mostrarTela(id) {
        document.querySelectorAll('.container > div').forEach(div => div.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    async function acaoLogin() {
        const email = document.getElementById('login-email').value;
        const senha = document.getElementById('login-senha').value;
        const { data, error } = await _supabase.auth.signInWithPassword({ email, password: senha });
        if (error) return alert("Erro: " + error.message);
        professorAtivo = data.user.user_metadata.full_name || email;
        document.getElementById('info-prof').innerText = "Logado como: " + professorAtivo;
        mostrarTela('tela-index');
    }

    async function acaoCadastro() {
        const email = document.getElementById('cad-email').value;
        const senha = document.getElementById('cad-senha').value;
        const nome = document.getElementById('cad-nome').value;
        const { error } = await _supabase.auth.signUp({ email, password: senha, options: { data: { full_name: nome } } });
        if (error) alert(error.message); else { alert("Conta criada! Verifique seu e-mail."); mostrarTela('tela-login'); }
    }

    async function fazerLogout() {
        await _supabase.auth.signOut();
        professorAtivo = "";
        mostrarTela('tela-login');
    }

    // CORRE√á√ÉO: Direcionando para a p√°gina recuperacao.html
    async function esqueciSenha() {
        const email = document.getElementById('login-email').value;
        if(!email) return alert("Digite o e-mail no campo de login!");
        const { error } = await _supabase.auth.resetPasswordForEmail(email, {
            redirectTo: 'https://eletifas.vercel.app/recuperacao.html',
        });
        if (error) alert(error.message); else alert("Link de recupera√ß√£o enviado! Verifique seu e-mail.");
    }

    function atualizarTurmas() {
        const mod = document.getElementById('modalidade').value;
        const sel = document.getElementById('turma');
        sel.innerHTML = '<option value="">Turma...</option>';
        if(mod && dadosEscola[mod]) {
            Object.keys(dadosEscola[mod]).forEach(t => sel.innerHTML += `<option value="${t}">${t}</option>`);
        }
    }

    function abrirModulo(tipo) {
        const mod = document.getElementById('modalidade').value;
        const tur = document.getElementById('turma').value;
        const are = document.getElementById('area').value;
        if(!tur || !are) return alert("Preencha √Årea, Modalidade e Turma!");
        listaAtualAlunos = dadosEscola[mod][tur];
        if(tipo === 'chamada') {
            const container = document.getElementById('lista-alunos-chamada');
            container.innerHTML = "";
            listaAtualAlunos.forEach((nome, i) => {
                container.innerHTML += `
                    <div class="aluno-card">
                        <span class="aluno-nome">${nome}</span>
                        <div class="toggles-chamada">
                            <div class="t-btn active-p" id="p-${i}" onclick="marcar(${i},'P')">P</div>
                            <div class="t-btn" id="f-${i}" onclick="marcar(${i},'F')">F</div>
                            <div class="t-btn" id="j-${i}" onclick="marcar(${i},'J')">J</div>
                        </div>
                    </div>`;
            });
            document.getElementById('titulo-chamada').innerText = "Chamada: " + tur;
            mostrarTela('tela-chamada');
        } else {
            const corpo = document.getElementById('corpo-notas');
            corpo.innerHTML = "";
            listaAtualAlunos.forEach((nome, i) => {
                corpo.innerHTML += `
                    <tr>
                        <td class="nome-aluno">${nome}</td>
                        <td><input type="number" step="0.1" class="input-nota n1" id="n1-${i}" oninput="calc(${i})"></td>
                        <td><input type="number" step="0.1" class="input-nota n2" id="n2-${i}" oninput="calc(${i})"></td>
                        <td><input type="number" step="0.1" class="input-nota n3" id="n3-${i}" oninput="calc(${i})"></td>
                        <td id="m-${i}" style="font-weight:bold; color:var(--primary)">0</td>
                    </tr>`;
            });
            document.getElementById('titulo-notas').innerText = "Notas: " + tur;
            mostrarTela('tela-notas');
        }
    }

    function marcar(i, status) {
        document.getElementById(`p-${i}`).className = status === 'P' ? 't-btn active-p' : 't-btn';
        document.getElementById(`f-${i}`).className = status === 'F' ? 't-btn active-f-cor' : 't-btn';
        document.getElementById(`j-${i}`).className = status === 'J' ? 't-btn active-j' : 't-btn';
    }

    function toggleNota(col) {
        const inputs = document.querySelectorAll('.' + col);
        const btn = document.getElementById('t-' + col);
        const estaVisivel = inputs[0].classList.contains('show-nota');
        if (estaVisivel) {
            inputs.forEach(inp => inp.classList.remove('show-nota'));
            btn.classList.remove('col-ativa');
            btn.innerText = 'LIGAR';
        } else {
            inputs.forEach(inp => inp.classList.add('show-nota'));
            btn.classList.add('col-ativa');
            btn.innerText = 'DESLIGAR';
        }
    }

    function calc(i) {
        const n1_v = document.getElementById(`n1-${i}`).value;
        const n2_v = document.getElementById(`n2-${i}`).value;
        const n3_v = document.getElementById(`n3-${i}`).value;
        let soma = 0, qtd = 0;
        if(n1_v !== "") { soma += parseFloat(n1_v); qtd++; }
        if(n2_v !== "") { soma += parseFloat(n2_v); qtd++; }
        if(n3_v !== "") { soma += parseFloat(n3_v); qtd++; }
        document.getElementById(`m-${i}`).innerText = qtd > 0 ? (soma / qtd).toFixed(1) : "0";
    }

    async function enviarFrequencia() {
        const btn = document.getElementById('btn-salvar-freq');
        btn.innerText = "ENVIANDO..."; btn.disabled = true;
        const payload = listaAtualAlunos.map((nome, i) => ({
            data: document.getElementById('data-aula').value,
            professor: professorAtivo,
            area: document.getElementById('area').value,
            modalidade: document.getElementById('modalidade').value,
            turma: document.getElementById('turma').value,
            aluno: nome,
            status: document.getElementById(`p-${i}`).classList.contains('active-p') ? 'Presen√ßa' : 
                   (document.getElementById(`f-${i}`).classList.contains('active-f-cor') ? 'Falta' : 'Justificada')
        }));
        try {
            await fetch(GOOGLE_URL, { method: 'POST', body: JSON.stringify(payload) });
            alert("Frequ√™ncia enviada!");
            mostrarTela('tela-index');
        } catch (e) { alert("Erro ao salvar."); }
        btn.innerText = "SALVAR CHAMADA"; btn.disabled = false;
    }

    async function enviarNotas() {
        const btn = document.getElementById('btn-salvar-notas');
        btn.innerText = "ENVIANDO..."; btn.disabled = true;
        const payload = listaAtualAlunos.map((nome, i) => ({
            professor: professorAtivo,
            turma: document.getElementById('turma').value,
            area: document.getElementById('area').value,
            bimestre: document.getElementById('bimestre-selecionado').value,
            aluno: nome,
            n1: document.getElementById(`n1-${i}`).value || "",
            n2: document.getElementById(`n2-${i}`).value || "",
            n3: document.getElementById(`n3-${i}`).value || "",
            media: document.getElementById(`m-${i}`).innerText
        }));
        try {
            await fetch(GOOGLE_URL, { method: 'POST', body: JSON.stringify(payload) });
            alert("Notas enviadas!");
            mostrarTela('tela-index');
        } catch (e) { alert("Erro ao salvar."); }
        btn.innerText = "SALVAR NA PLANILHA"; btn.disabled = false;
    }
</script>
</body>
</html>




