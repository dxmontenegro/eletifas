<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eletIFAS - EEMTI DRAG√ÉO DO MAR</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #004d40; --secondary: #00796b; --bg: #f1f8f7; --accent: #c62828; --warning: #ef6c00; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); margin: 0; padding: 10px; display: flex; justify-content: center; }
        .container { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 550px; text-align: center; position: relative; min-height: 600px; display: flex; flex-direction: column; align-items: center; }
        .hidden { display: none !important; }
        .logo-escola { width: 120px; margin: 0 auto 10px auto; display: block; }
        h1 { color: var(--primary); font-size: 28px; margin: 0; }
        h2 { color: var(--secondary); font-size: 14px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
        input, select, button { width: 100%; padding: 12px; margin-top: 8px; border-radius: 8px; border: 1.5px solid #ccc; box-sizing: border-box; font-size: 16px; }
        .btn-main { background: var(--primary); color: white; font-weight: bold; cursor: pointer; border: none; }
        .btn-outline { background: white; color: var(--primary); border: 2px solid var(--primary); font-weight: bold; cursor: pointer; }
        .btn-relatorio { background: white; color: var(--warning); border: 2px solid var(--warning); font-weight: bold; cursor: pointer; margin-top: 15px; }
        .btn-link { background: none; border: none; color: var(--secondary); text-decoration: underline; cursor: pointer; font-size: 14px; margin-top: 10px; width: auto; }
        .btn-sair { background: var(--accent); color: white; padding: 8px 15px; font-size: 12px; border: none; border-radius: 6px; cursor: pointer; width: auto; position: absolute; top: 20px; right: 20px; }
        
        /* Estilos de Relat√≥rio */
        .filtro-card { background: #f9f9f9; padding: 15px; border-radius: 12px; border: 1px solid #eee; margin-bottom: 15px; text-align: left; width: 100%; box-sizing: border-box; }
        .filtro-label { font-size: 11px; font-weight: bold; color: var(--secondary); text-transform: uppercase; margin-top: 10px; display: block; }
        
        .tabela-wrapper { overflow-x: auto; margin-top: 15px; width: 100%; border-radius: 8px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; background: white; }
        th { background: var(--primary); color: white; padding: 10px; }
        td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        .nome-aluno { text-align: left; font-size: 11px; font-weight: bold; text-transform: uppercase; min-width: 180px; }
        
        .aluno-card { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; width: 100%; }
        .t-btn { width: 32px; height: 32px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 4px; }
        .active-p { background: #2e7d32 !important; color: white !important; }
        .active-f-cor { background: var(--accent) !important; color: white !important; }
        .active-j { background: #ef6c00 !important; color: white !important; }
        .footer-credits { margin-top: auto; padding-top: 30px; font-size: 11px; color: var(--accent); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <img src="imagem1.png" class="logo-escola" alt="Logo">
    <h1>eletIFAS</h1>
    <h2>EEMTI DRAG√ÉO DO MAR</h2>

    <div id="tela-login" style="width: 100%;">
        <input type="email" id="login-email" placeholder="E-mail">
        <input type="password" id="login-senha" placeholder="Senha">
        <button class="btn-main" onclick="acaoLogin()">ENTRAR</button>
        <button class="btn-link" onclick="solicitarReset()">Esqueci minha senha</button>
        <button class="btn-outline" style="margin-top:20px" onclick="mostrarTela('tela-cadastro')">CRIAR CONTA</button>
    </div>

    <div id="tela-cadastro" class="hidden" style="width: 100%;">
        <h3>Novo Professor</h3>
        <input type="text" id="cad-nome" placeholder="Nome Completo">
        <input type="email" id="cad-email" placeholder="E-mail">
        <input type="password" id="cad-senha" placeholder="Senha (m√≠n. 6 chars)">
        <button class="btn-main" onclick="acaoCadastro()">CADASTRAR</button>
        <button class="btn-outline" style="margin-top:10px" onclick="mostrarTela('tela-login')">VOLTAR</button>
    </div>

    <div id="tela-index" class="hidden" style="width: 100%;">
        <button class="btn-sair" onclick="fazerLogout()">SAIR</button>
        <div id="info-prof" style="font-size:12px; margin-bottom:10px; color:#666;">Professor</div>
        
        <input type="date" id="data-aula">
        
        <select id="area">
            <option value="">Selecione a √Årea...</option>
            <option value="GEST√ÉO">GEST√ÉO</option>
            <option value="Linguagens">Linguagens</option>
            <option value="Matem√°tica">Matem√°tica</option>
            <option value="C. Natureza">Ci√™ncias da Natureza</option>
            <option value="C. Humanas">Ci√™ncias Humanas</option>
        </select>
        
        <select id="modalidade" onchange="atualizarTurmas('turma')">
            <option value="">Modalidade...</option>
            <option value="integral">Integral</option>
            <option value="noturno">Noturno</option>
        </select>
        
        <select id="turma"><option value="">Selecione a Turma...</option></select>
        
        <div style="display: flex; gap: 10px; margin-top: 15px;">
            <button class="btn-main" onclick="abrirModulo('chamada')">üìù CHAMADA</button>
            <button class="btn-outline" onclick="abrirModulo('notas')">üìä NOTAS</button>
        </div>
        
        <button class="btn-relatorio" onclick="abrirPainelRelatorio()">üîç RELAT√ìRIO CONSOLIDADO</button>
    </div>

    <div id="tela-chamada" class="hidden" style="width: 100%;">
        <h3 id="titulo-chamada"></h3>
        <div id="lista-alunos-chamada" style="max-height: 400px; overflow-y: auto;"></div>
        <button class="btn-main" id="btn-salvar-freq" onclick="enviarFrequencia()">SALVAR FREQU√äNCIA</button>
        <button class="btn-outline" style="margin-top:10px" onclick="mostrarTela('tela-index')">VOLTAR</button>
    </div>

    <div id="tela-notas" class="hidden" style="width: 100%;">
        <h3 id="titulo-notas">Notas</h3>
        <select id="bimestre-selecionado">
            <option>1¬∫ BIMESTRE</option><option>2¬∫ BIMESTRE</option>
            <option>3¬∫ BIMESTRE</option><option>4¬∫ BIMESTRE</option>
        </select>
        <div class="tabela-wrapper">
            <table id="tabela-notas-input"></table>
        </div>
        <button class="btn-main" id="btn-salvar-notas" onclick="enviarNotas()">SALVAR NOTAS</button>
        <button class="btn-outline" style="margin-top:10px" onclick="mostrarTela('tela-index')">VOLTAR</button>
    </div>

    <div id="tela-relatorios" class="hidden" style="width: 100%;">
        <h3 style="color: var(--primary); margin-bottom: 5px;">Relat√≥rio Consolidado</h3>
        
        <div class="filtro-card">
            <span class="filtro-label">1. Turma e √Årea</span>
            <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                <select id="rel-area" style="flex: 1.2;">
                    <option value="">√Årea...</option>
                    <option value="GEST√ÉO">GEST√ÉO</option>
                    <option value="Linguagens">Linguagens</option>
                    <option value="Matem√°tica">Matem√°tica</option>
                    <option value="C. Natureza">C. Natureza</option>
                    <option value="C. Humanas">C. Humanas</option>
                </select>
                <select id="rel-turma" style="flex: 1;">
                    <option value="">Turma...</option>
                </select>
            </div>

            <span class="filtro-label">2. Faltas (Escolha o M√™s)</span>
            <select id="rel-mes" style="margin-bottom: 10px;">
                <option value="01">Janeiro</option><option value="02" selected>Fevereiro</option>
                <option value="03">Mar√ßo</option><option value="04">Abril</option>
                <option value="05">Maio</option><option value="06">Junho</option>
                <option value="07">Julho</option><option value="08">Agosto</option>
                <option value="09">Setembro</option><option value="10">Outubro</option>
                <option value="11">Novembro</option><option value="12">Dezembro</option>
            </select>

            <span class="filtro-label">3. Notas (Escolha o Bimestre)</span>
            <select id="rel-bimestre">
                <option>1¬∫ BIMESTRE</option><option>2¬∫ BIMESTRE</option>
                <option>3¬∫ BIMESTRE</option><option>4¬∫ BIMESTRE</option>
            </select>
        </div>

        <button class="btn-main" style="background: var(--warning);" onclick="gerarRelatorioConsolidado()">
            üîç GERAR RELAT√ìRIO
        </button>

        <div class="tabela-wrapper">
            <table>
                <thead>
                    <tr>
                        <th style="text-align: left;">Estudante</th>
                        <th>Faltas</th>
                        <th>Nota</th>
                    </tr>
                </thead>
                <tbody id="corpo-relatorio"></tbody>
            </table>
        </div>
        
        <button class="btn-outline" style="margin-top:20px" onclick="mostrarTela('tela-index')">VOLTAR</button>
    </div>

    <div class="footer-credits">D.S. MONTENEGRO - EEMTI DRAG√ÉO DO MAR</div>
</div>

<script>
    const SUPABASE_URL = 'https://bdjqajzhlkdfagdfknmh.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJkanFhanpobGtkZmFnZGZrbm1oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NTA5MDcsImV4cCI6MjA4NjMyNjkwN30.hxh4adeSNM7FazeNkinwPrJEZdxsZkhtPTB5zU6eub0';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let professorAtivo = "";
    let listaAtualAlunos = [];
    document.getElementById('data-aula').valueAsDate = new Date();

    const dadosEscola = {
        integral: {
            "1¬∫ A": ["ANA BEATRIZ CABRAL DA SILVA", "ANA BEATRIZ DANTAS BERNARDO", "ANA BEATRIZ OLIVEIRA SERRA", "ANA CAROLYNA CARNEIRO SOUSA", "ANA LUIZA DE SOUSA LOURENCO", "ANNA JULIA RODRIGUES DE MELO", "DEBORA IOLANDA GOMES DA SILVA", "DEVIDSON RAMOS DE OLIVEIRA", "DIOGO SANTOS FERREIRA", "FERNANDO ERLANIO DE OLIVEIRA AGUIAR", "JESSICA DEBORA SILVA OLIVEIRA", "JOAO GABRIEL SOUSA RODRIGUES", "JOAO LUCAS SOUSA DA COSTA", "JORGE MIGUEL ARAUJO LOPES", "JULIA EVELLEN PAIVA DA SILVA", "KAILANY DA SILVA COSTA", "KAROLLAINY OLIVEIRA SOUSA", "KAUA ARAUJO MENDES", "LUIS GUSTAVO COSTA FERNANDES", "LUNNA DE LIMA ABREU", "MARA LIDIA FERREIRA DE FARIAS", "MARIA ALICIA CARVALHO NUNES", "MARIA CLARA DA CRUZ SILVA", "MARIA EDUARDA BERNARDO SOUZA", "MARIA ISABEL ALVES PEREIRA", "MARYA EDUARDA DOS SANTOS LOBAO", "MOISES ARCANJO FLOR FERREIRA", "RAYSSA DA SILVA RODRIGUES", "RYAN DA SILVA COSTA", "SAMUEL SANTIAGO DE LIMA", "SAMYRA MARIA CAVALCANTE CRUZ", "THALES GABRIEL FERREIRA DE LIMA", "TIAGO TAVARES SOUZA", "YANN FERREIRA SILVA COELHO", "YASMIN SILVA COUTO"],
            "1¬∫ B": ["ALESSANDRO DOS SANTOS RODRIGUES", "ANA ESTER DA SILVA FELIX", "ANA RUTY PEREIRA DOS SANTOS", "ARIELE DE CARVALHO GONDIM BARBOSA LEMOS", "BERNARDO BATISTA LIMA", "BRENO HENRIQUE CASTRO VALENTIM", "EDUARDO SOUSA GAMA", "ESTER VIRGINIO MARIANO", "FILIPE BRAS DE PAULA", "FRANCISCO EDILSON OLIVEIRA ANDRADE", "GABRIELA RODRIGUES DOS SANTOS", "GEORGE TEODOZIO SILVA", "GUSTAVO NERY TEIXEIRA DE PAULA", "IAN DE ABREU VIANA", "JOSE MARLEY MENDES DOS SANTOS", "LARA WINY SOUSA DA SILVA", "LOUISE ANDRYA FERREIRA DE SOUSA LIMA", "LUARA KALYNE DA CONCEICAO SARAIVA", "LUDMILA LOPES EVANGELISTA", "MARCOS VINICIUS ARAUJO LIMA ALVES", "MARIA BEATRIZ TELES GUEDES DE SOUSA", "MARIA EDUARDA MARTINS DANTAS", "MARIA GABRIELA DA SILVA MACEDO ARAUJO", "MARIA MANUELA FERREIRA LIMA", "MARIA VITORIA SANTOS DE LIMA", "MAYRA ALEXANDRA DOS SANTOS CARMO", "MIGUEL ANTONIO LOPES DA CUNHA", "NATHALLY ELOAR DO SANTOS HENRIQUE DA SILVA", "PAULO LUCAS VIEIRA DOS SANTOS", "PEDRO LUAN OLIVEIRA SANTOS", "PEDRO LUCAS ARAUJO BRAUNA", "RHUAN DE BRITO RODRIGUES", "RODRIGO OLIVEIRA DA SILVA", "SAULO LUKA PESSOA TABOSA", "YAN DAVID FEITOSA RODRIGUES"],
            "1¬∫ C": ["ALICE FIRMINO DOS SANTOS SILVEIRA", "ANA LIVIA DA CRUZ BORGES", "ANA VITORIA SOUSA DE LIMA", "BRENDO LUCAS DOS SANTOS SOUSA", "BRIAN VALENTE DOS SANTOS", "CAIO VICTOR SALES DO NASCIMENTO", "CARLOS YUDI SILVA DO NASCIMENTO", "CECILIA BORGES OLIVEIRA", "DALILA SIMONE DOS SANTOS", "ELNATAN DOS REIS RODRIGUES", "ERICK SANTOS ARAUJO", "FABIANO SANTIAGO DOS ANJOS", "FRANCISCO MANOEL DOS ANJOS DA SILVA", "GABRIEL CASTRO DE SOUSA", "HELLEN MARIA DO NASCIMENTO BERNARDO", "ISABELE ROCHA FERREIRA", "JOAO LEVI GOMES VIEIRA", "JOAO PEDRO LIMA SOARES", "JOAO VITOR DE PAULO DO NASCIMENTO", "JOSE CAUA DOS SANTOS RODRIGUES", "JULIA NICOLY DE LIMA", "KEVEN GABRIEL DE SOUSA RIBEIRO", "LUIZ OTAVIO DA SILVA MOREIRA", "MARIA EDUARDA BEZERRA SANTOS", "MARIA EDUARDA RODRIGUES GUIMARAES", "MARIA LUIZA DA SILVA FRANCA", "MARIA VITORIA DA SILVA DO NASCIMENTO", "SAMUEL FREITAS ALVES", "SARAH KELLY FERREIRA SOUSA", "YAN MIQUEIAS OLIVEIRA ALVES", "YASMIN PESSOA DA ROCHA"],
            "2¬∫ A": ["ANA LIVIA DOS SANTOS BARATA", "ANTONIO VINICIUS ROCHA FERREIRA", "BRYANN VICTOR PEREIRA XAVIER", "CARLA SAMANTHA DE OLIVEIRA ASSARE", "CLARISSE YASMIN DA SILVA EVARISTO", "EMANUELLE HIGINO DE SOUZA", "ENZO DOS SANTOS MONTEIRO", "ERIK DOUGLAS LIMA MARTINS", "FRANCISCO WEVERTON DOS SANTOS", "GUILHERMY KAUA DA SILVA FERREIRA", "IRVINA AGATA DA SILVA FRANCA", "JENYFER RAISSA DO NASCIMENTO COSTA", "JESSIANE RIBEIRO CARNEIRO", "KAUA GUILHERME CRUZ SILVA", "KELRIANE BARROS DA COSTA", "LUIZ EDUARDO LOURENCO FIGUEIRA MACEDO", "MARCOS KAYRON ALBUQUERQUE ALVES", "MARIA IONARA FERREIRA DOS SANTOS", "MARIA SARAH LOPES DE BRITO", "MAYCON DO NASCIMENTO PEREIRA", "NARA LAUANE CARNEIRO FERREIRA", "PEDRO GABRIEL MOREIRA DA COSTA", "PEDRO HENRIQUE SOUSA MARTINS DA SILVA", "PEDRO VIN√çCIUS OLIVEIRA DOS ANGELOS", "RYAN BARBOSA DE SOUSA", "SUELEN CRISTINA FARIAS LEAL", "VITORIA SANTOS DE OLIVEIRA SILVA", "WELLY DE CASTRO BULHOES", "YURI CAETANO CARVALHO"],
            "2¬∫ B": ["ANA BRUNA FELIX ACARCIO PEREIRA", "ANA LAYS DE ALMEIDA", "ANA LIVIA VASCONCELOS LOBO ROCHA", "ANA VITORIA DE SOUZA AMARAL", "CALEBE DA SILVA SANTOS", "CECILIA SILVA OLIVEIRA", "DEBORAH CARVALHO BEZERRA", "GLENDA VITORIA GOMES DE LIVIA", "GUILHERME BARBOSA LOURENCO", "JOAO PIERRY ALVES DE OLIVEIRA", "JOEL BARBOSA EVANGELISTA", "KAROLYNNE", "KERISSON ANDRADE AMORIM", "KEYLLON VITORIO DE SOUZA AMBE", "LUANA FONSECA MONTEIRO", "LUCAS OLIVEIRA DE SOUZA", "MARCOS VINICIUS SILVANO BATISTA", "MARIA EDUARDA SANTANA RODRIGUES", "MARIA HELLEN SOUSA BARROS", "MIGUEL RONEY PEREIRA DUARTE", "MOYSHES GOMES DO NASCIMENTO", "NICOLAS DE FREITAS LOPES", "NYKOLAS PEREIRA RIOS", "PEDRO RIBEIRO HOLANDA", "RIHANHA FERREIRA DOS REIS", "RYANBERG FERREIRA BARBOSA DA SILVA", "VARVARA OZEROVA", "VICTOR GABRIEL LIMA DE SOUZA", "YAN DHARLLYS MARTINS DO NASCIMENTO"],
            "2¬∫ C": ["AMANDA PEREIRA DA PENHA", "ANA JULIA FERNANDES DE SOUSA", "ANA LARA CORREIA LOPES", "ARTHUR CARLOS DE ALMEIDA MOTTA", "ARTHUR MONTENEGRO VENANCIO", "BRENDA PEREIRA LIMA", "ELLEN CRISTINA SILVA DOS SANTOS", "EZEQUIEL GOMES DE SENA", "FRANCISCA SAMILLY DA SILVA ARAUJO", "GABRIEL ARAUJO SILVA", "GABRIEL ONOFRE DE SOUSA MACIEL", "HELOARA MORAES VERCOSA", "JOSE ELIVELTON OLIVEIRA MAGALHAES", "KAUA EMERSON LIMA MENEZES", "KAYANNE RODRIGUES TEIXEIRA", "KENCIANE OLIVEIRA DE SOUSA", "MARIA ALICE RIBEIRO DA SILVA", "MARIA APARECIDA SILVA DE SOUZA", "MARIA EDUARDA CARIOLANO DE ARAUJO", "MARIA FERNANDA SILVA DOS SANTOS FELIX", "MARIA LAYANE MONTEIRO DE LIMA", "MIGUEL VASCONCELOS DINIZ", "MIRELLA DE PAULA NASCIMENTO", "PEDRO ADRIAN DA SILVA", "PEDRO ITALO MAIA SOUSA", "PEDRO LUCAS FEIJ√ì", "REBECA DIOGO SILVA MONTENEGRO", "SAMYLLY RAYSSA DIas ARAUJO", "SUZANNA RAFAELLE COSTA S. DO NASCIMENTO", "YURI ANDRADE DA MATA"],
            "3¬∫ A": ["ADRYAN DE PAULA ANDRADE", "ALISSON COSTA DA SILVA", "ANA BEATRIZ FURTADO TAVARES", "ANA CAROLINE AIRES PEREIRA", "ARIANI DA GUIA DOS SANTOS", "BRUNO KENNEDY SOUSA SOARES", "CAMILY DE OLIVEIRA COSTA", "DANIELA CASTRO DE SOUZA", "DIOGO ADRIAN TAVARES DE LIMA", "EMANUELLE FERREIRA DE SOUSA", "EMANUELLY DE CASSIA PINTO QUEIROZ", "EMILY SOARES CUNHA GOMES", "FERNANDO ANTONIO MOTA DE SOUSA FILHO", "ISABELLA ALVES PEREIRA", "IZABELLE CARVALHO SILVA", "JEFERSON LAZANO MENDES DINIZ", "JOAO NICOLAS DO NASCIMENTO", "JO√ÉO PEDRO", "KAYLA VITORIA MARQUES CAMPOS", "KELTON MATEUS DE SOUSA NEVES", "LARA RAYELE BORGES GOES", "LAYS NAYRA GOMES FERREIRA", "LETICIA BARBOSA TEIXEIRA", "LIAN DE SOUSA FERREIRA", "LUIDY RAYAN PEREIRA DA SILVA", "LUIS DANIEL ALMEIDA DA SILVA", "LUIZ GUSTAVO SANTANA DA MATA", "MARIA FERNANDA SILVA SOUSA", "PEDRO ERICK BEZERRA DE LIMA", "PEDRO LUCAS DA SILVA GOMES", "PEDRO LUCAS LOPES MATIAS", "SILAS DOS SANTOS ALMEIDA", "YARLEI FERREIRA LOBAO", "YASMIM LOURENCO DE FREITAS"],
            "3¬∫ B": ["ANA ALICE RODRIGUES DA SILVA", "ANA CLARA DOS SANTOS DE PAULA", "ANA KARINE ALBERTO SILVA", "ANA LUIZA ALVES DE OLIVEIRA", "ANDRE HENRIQUE DE SOUZA CAMPOS", "ANGELA PATRICIA OLIVEIRA FRANCA LIMA", "ANTONIA VANESSA LIMA DA MATA", "CARLOS MISAEL DA SILVA FELIX", "EDUARDA GABRIELE FERREIRA DOS SANTOS", "FL√ÅVIO NOGUEIRA FILHO", "FRANCISCO HUGO DA SILVA ARAUJO", "FRANCISCO RENAN DE SOUZA RODRIGUES", "GABRIEL VITOR ABREU MORAES", "GUDSON MACEDO SANTANA", "ISAAC ASSUNCAO RODRIGUES DE MATOS", "JOAO MANOEL DIONIZIO DA SILVA", "JOAO VICTOR SOUSA DA COSTA", "JOSE ADRIEL DE SOUSA BERNARDO", "JOSE RENAN ARAUJO LIMA CASTRO", "KATHERINE LEITE BRAGA", "KERLLON PAZ DA SILVA", "LARA GABRIELLE RODRIGUES MORAIS", "LETICIA HONORATO ALVES", "LUCAS DOS SANTOS MATOKANOVIC", "MARCIO MARLEY RIBEIRO DA SILVA", "MARCUS YUAN PACHECO DE SOUSA", "MARIA CLARA CALDAS RODRIGUES", "MARIA EVELYN DA SILVA SABINO", "ROMAN DUBOVIK", "RYAN PEREIRA DE SOUSA", "RYANNA FERREIRA RODRIGUES", "SAMUEL MOREIRA FERREIRA", "VERONICA DANIELA NUNEZ TORRES", "WESLEI FERREIRA GOIS", "YORRANA DA SILVA GON√áALVES"]
        },
        noturno: {
            "1¬∫ D": ["ANA PAULA FERREIRA DA SILVA", "ANA LARA LOPES POLICARPO", "CARLOS EDUARDO S. NASCIMENTO", "CARLOS ICARO SOUSA BARRETO", "CARMEN L√öCIA DO NASCIMENTO SANTOS", "CYNTHIA BIANCA RIBEIRO", "DHEIMISON LEANDRO", "DIOGO VINICIUS RIBEIRO DE SOUSA", "EDUARDO DA SILVA SILVEIRA", "FRANCISCA SILVANEIDE DA SILVA", "JOSE CAUA DOS SANTOS RODRIGUES", "LAURA CLARIANE LIMA DUARTE", "LUAN RODRIGUES DE MORAIS", "MARIA FREITAS DE ALMEIDA", "MARIA GABRIELA VERAS FERREIRA", "MARIA VANUSIA COELHO", "NATANAEL LOBAO DA SILVA", "NATIELE GOMES COSTA", "RAYSSA SOUSA COSTA", "ROSA MARIA DA SILVA", "SAMUEL COSTA REBOUCAS", "SIMONE ALVES DE SOUSA", "THAYSSA STHER FELIX REBOU√áAS", "WILCKY SANTOS PEREIRA", "YOHANA CORTEZ DE AZEVEDO", "YURI TEIXEIRA DA SILVA"],
            "2¬∫ D": ["ARIEL LUCAS CARVALHO", "ARIELY LET√çCIA LIMA OLIVEIRA", "CARLOS RYAN OLIVEIRA FERREIRA", "DOUGLAS MARCELO FERNANDES OLIVEIRA DE MELO", "ELOIZA ZAQUEU DA SILVA SANTOS", "EMILY AZEVEDO DOS SANTOS", "FAGNER LUCENA DA SILVA", "FRANCISCO DAVI RIBEIRO FREITAS", "FRANCISCO ELIVERTON ALVES DIAS", "GABRIEL HENRIQUE FREITAS DE CARVALHO", "JOAO MARCOS NOGUEIRA PEREIRA", "JOSE ROMULO FACUNDE DA SILVA", "JULYAM NAYRIS GUEDES ALBUQUERQUE", "KATIANE DE SOUZA JULIAO GOMES", "KAUA CUNHA MATIAS", "LEANDRO RAQUEL GOMES", "LUANA PRISCILA OLIVEIRA", "LUCAS HONORIO DE SOUSA", "MARIA SUYANE BARBOSA GOMES", "MELISSA DOS SANTOS VITURINO", "PEDRO YTALLO ALVES DE ARAUJO MOTA", "RAY PEREIRA ROCHA NOGUEIRA", "RAYANE BERNARDO DA SILVA SOARES", "RIAN DE LIMA NASCIMENTO", "SARA ROCHA DE SENA", "STEPHANY REIS FONSECA", "TAINARA DE SOUZA"],
            "3¬∫ C": ["ANA LUISA PEREIRA DOS SANTOS", "ARYANE SILVA DA GUIA", "EDUARDO DA SILVA MACEDO ARAUJO", "ERIANA KEZIA NASCIMENTO RODRIGUES", "FRANCISCA ELLEN CASTRO DOS SANTOS", "GABRIELEM MARIA LIMA DE CASTRO", "IZABELE MARTINS DE SOUSA", "JOAO MARCELO CESARIO DA SILVA", "JONATHAN VITOR DA SILVA ALVES", "KAUA CARDOSO DE OLIVEIRA", "KAUA KEVEN AZEVEDO DA SILVA", "LUIZ DAVI CRUZ DA ROCHA", "MARIA JAMILE DE SOUSA PEREIRA", "MARIA REBECA SILVA DA CRUZ", "MARIANA NASCIMENTO DA SILVA", "NICOLAS ARAUJE DE FREITAS", "SAMUEL RODRIGUES GOMES", "SARA DOS SANTOS HAYASHI", "VITORIA CAROLINE MORAIS DE LIMA", "WESLEY SANTANA FIRMINO"]
        }
    };

    function mostrarTela(id) {
        document.querySelectorAll('.container > div').forEach(div => div.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    // AUTH
    async function acaoLogin() {
        const email = document.getElementById('login-email').value;
        const senha = document.getElementById('login-senha').value;
        const { data, error } = await _supabase.auth.signInWithPassword({ email, password: senha });
        if (error) return alert("Erro: " + error.message);
        professorAtivo = data.user.user_metadata?.full_name || email;
        document.getElementById('info-prof').innerText = "Professor(a): " + professorAtivo;
        mostrarTela('tela-index');
    }

    async function acaoCadastro() {
        const email = document.getElementById('cad-email').value;
        const senha = document.getElementById('cad-senha').value;
        const nome = document.getElementById('cad-nome').value;
        const { error } = await _supabase.auth.signUp({ email, password: senha, options: { data: { full_name: nome } } });
        if (error) alert(error.message); else { alert("Verifique seu e-mail para confirmar!"); mostrarTela('tela-login'); }
    }

    async function solicitarReset() {
        const email = document.getElementById('login-email').value || prompt("Seu e-mail:");
        if (!email) return;
        const { error } = await _supabase.auth.resetPasswordForEmail(email);
        alert(error ? error.message : "Link de recupera√ß√£o enviado!");
    }

    async function fazerLogout() { await _supabase.auth.signOut(); mostrarTela('tela-login'); }

    // UTILS
    function atualizarTurmas(idSelect) {
        const mod = document.getElementById('modalidade').value;
        const sel = document.getElementById(idSelect);
        sel.innerHTML = '<option value="">Turma...</option>';
        if(mod && dadosEscola[mod]) {
            Object.keys(dadosEscola[mod]).forEach(t => sel.innerHTML += `<option value="${t}">${t}</option>`);
        }
    }

    function abrirModulo(tipo) {
        const mod = document.getElementById('modalidade').value;
        const tur = document.getElementById('turma').value;
        const are = document.getElementById('area').value;
        if(!tur || !are) return alert("Selecione os campos √Årea e Turma!");
        
        listaAtualAlunos = dadosEscola[mod][tur];
        if(tipo === 'chamada') {
            const container = document.getElementById('lista-alunos-chamada');
            container.innerHTML = "";
            listaAtualAlunos.forEach((nome, i) => {
                container.innerHTML += `<div class="aluno-card"><span class="nome-aluno">${nome}</span><div style="display:flex; gap:5px;"><div class="t-btn active-p" id="p-${i}" onclick="marcar(${i},'P')">P</div><div class="t-btn" id="f-${i}" onclick="marcar(${i},'F')">F</div><div class="t-btn" id="j-${i}" onclick="marcar(${i},'J')">J</div></div></div>`;
            });
            document.getElementById('titulo-chamada').innerText = "Chamada: " + tur;
            mostrarTela('tela-chamada');
        } else {
            const tabela = document.getElementById('tabela-notas-input');
            tabela.innerHTML = "<thead><tr><th>Estudante</th><th>NOTA</th></tr></thead><tbody>";
            listaAtualAlunos.forEach((nome, i) => {
                tabela.innerHTML += `<tr><td class="nome-aluno">${nome}</td><td><input type="number" step="0.1" id="nota-${i}" style="width:60px; text-align:center;"></td></tr>`;
            });
            tabela.innerHTML += "</tbody>";
            document.getElementById('titulo-notas').innerText = "Lan√ßar Notas: " + tur;
            mostrarTela('tela-notas');
        }
    }

    function marcar(i, status) {
        document.getElementById(`p-${i}`).className = status === 'P' ? 't-btn active-p' : 't-btn';
        document.getElementById(`f-${i}`).className = status === 'F' ? 't-btn active-f-cor' : 't-btn';
        document.getElementById(`j-${i}`).className = status === 'J' ? 't-btn active-j' : 't-btn';
    }

    // DATABASE ACTIONS
    async function enviarFrequencia() {
        const btn = document.getElementById('btn-salvar-freq');
        btn.disabled = true; btn.innerText = "SALVANDO...";
        const payload = listaAtualAlunos.map((nome, i) => ({
            data: document.getElementById('data-aula').value,
            professor: professorAtivo,
            area: document.getElementById('area').value,
            turma: document.getElementById('turma').value,
            aluno: nome,
            status: document.getElementById(`p-${i}`).classList.contains('active-p') ? 'Presen√ßa' : (document.getElementById(`f-${i}`).classList.contains('active-f-cor') ? 'Falta' : 'Justificada')
        }));
        const { error } = await _supabase.from('frequencia').insert(payload);
        if (error) alert(error.message); else { alert("Salvo com sucesso!"); mostrarTela('tela-index'); }
        btn.disabled = false; btn.innerText = "SALVAR FREQU√äNCIA";
    }

    async function enviarNotas() {
        const btn = document.getElementById('btn-salvar-notas');
        btn.disabled = true; btn.innerText = "SALVANDO...";
        const payload = listaAtualAlunos.map((nome, i) => ({
            professor: professorAtivo,
            turma: document.getElementById('turma').value,
            area: document.getElementById('area').value,
            bimestre: document.getElementById('bimestre-selecionado').value,
            aluno: nome,
            nota: parseFloat(document.getElementById(`nota-${i}`).value) || 0
        }));
        const { error } = await _supabase.from('notas').insert(payload);
        if (error) alert(error.message); else { alert("Notas salvas!"); mostrarTela('tela-index'); }
        btn.disabled = false; btn.innerText = "SALVAR NOTAS";
    }

    // RELAT√ìRIO CONSOLIDADO (A NOVA L√ìGICA)
    function abrirPainelRelatorio() {
        const mod = document.getElementById('modalidade').value;
        if(!mod) return alert("Selecione a Modalidade (Integral/Noturno) primeiro!");
        
        atualizarTurmas('rel-turma');
        
        // Sincroniza com o que j√° foi selecionado no index (por conveni√™ncia)
        document.getElementById('rel-area').value = document.getElementById('area').value;
        document.getElementById('rel-turma').value = document.getElementById('turma').value;
        
        mostrarTela('tela-relatorios');
    }

    async function gerarRelatorioConsolidado() {
        const mod = document.getElementById('modalidade').value;
        const tur = document.getElementById('rel-turma').value;
        const are = document.getElementById('rel-area').value;
        const mesRef = document.getElementById('rel-mes').value;
        const bimRef = document.getElementById('rel-bimestre').value;

        if(!tur || !are) return alert("Escolha √Årea e Turma para o relat√≥rio!");

        const corpo = document.getElementById('corpo-relatorio');
        corpo.innerHTML = "<tr><td colspan='3'>üîÑ Buscando dados...</td></tr>";

        try {
            // Busca faltas da √ÅREA E TURMA
            const { data: faltasData } = await _supabase
                .from('frequencia')
                .select('aluno, data')
                .eq('turma', tur)
                .eq('area', are)
                .eq('status', 'Falta');

            // Busca notas da √ÅREA E TURMA E BIMESTRE
            const { data: notasData } = await _supabase
                .from('notas')
                .select('aluno, nota')
                .eq('turma', tur)
                .eq('area', are)
                .eq('bimestre', bimRef);

            corpo.innerHTML = "";
            const alunos = dadosEscola[mod][tur];

            alunos.forEach(aluno => {
                const totalFaltas = faltasData?.filter(f => 
                    f.aluno === aluno && f.data.includes(`-${mesRef}-`)
                ).length || 0;

                const notaObj = notasData?.find(n => n.aluno === aluno);
                const notaTexto = notaObj ? notaObj.nota.toFixed(1) : "---";

                corpo.innerHTML += `<tr>
                    <td class="nome-aluno">${aluno}</td>
                    <td style="color:${totalFaltas > 0 ? 'red' : '#2e7d32'}; font-weight:bold;">${totalFaltas}</td>
                    <td style="font-weight:bold; color:var(--primary);">${notaTexto}</td>
                </tr>`;
            });
        } catch (err) {
            alert("Erro ao carregar dados.");
        }
    }
</script>
</body>
</html>
